#!/bin/bash

## Description: Sets up the local development environment for the project
## Usage: setup
## Example: "ddev setup"

echo "üíª Setting up the project"
echo ""


    echo "üóÑÔ∏è What's the name of your database dump file inside the project root? (default: db.sql)"
    read dumpfile
    if [[ -z $dumpfile ]]; then
            dumpfile="db.sql"
    fi
        echo ""

    if [ ! -f "./$dumpfile" ]; then
        echo "‚ùå Database file does not exist. "
        exit 1
    fi

echo

echo "üöÄ Scaffolding"
# ---------------------------------
# SCAFFOLDING
# ---------------------------------
rm -rf ./vendor
rm -rf ./public/storage
rm -rf ./node_modules
rm -rf ./.env
cp .env.ddev .env


composer install
php artisan storage:link
php artisan key:generate

# ---------------------------------
#  DATABASE
# ---------------------------------
echo "‚è≥ Start importing database dump. This may take a while!";
import-db --file=$dumpfile
mysql -u db -pdb --host=db db < $dumpfile

echo "‚úÖ Finished importing database dump.";

php artisan migrate


echo ""
echo "‚úÖ Updated!"
echo ""

# ---------------------------------
# Assets
# ---------------------------------
echo ""
echo "üì¶ Installing assets..."
npm install

echo ""
echo "üî® Compiling assets... "
npm run dev

echo ""
echo "Start by visiting https://mis.ddev.site üöÄ"
exit 0
